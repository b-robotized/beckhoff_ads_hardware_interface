<?xml version="1.0" encoding="utf-8"?>
<TcPlcObject Version="1.1.0.1" ProductVersion="3.1.4024.15">
  <POU Name="MAIN" Id="{ac002873-776d-4096-82aa-e6da7e9c1d13}" SpecialFunc="None">
    <Declaration><![CDATA[PROGRAM MAIN
VAR
	(*
	================================================================
	ROS 2 Control Interface Variables
	These variables correspond to the PLC_symbol parameters in your URDF.
	================================================================
	*)

	// --- Command Interfaces (Inputs from ROS) ---
	joggingEnabled	: BOOL;		// Mapped to: <command_interface name="joggingEnabled">
	myRobotMode			: UDINT;	// Mapped to: <command_interface name="myRobotMode">
	
	// Mapped to: <state_interface name="commandPos">, where n is the element index in this array
	commandPos		: ARRAY[0..1] OF BOOL;

	// --- State Interfaces (Outputs to ROS) ---
	statusError	: BOOL;		// Mapped to: <state_interface name="statusError">
	batteryVoltage	: LREAL;		// Mapped to: <state_interface name="batteryVoltage">
	
	// Mapped to: <state_interface name="currentPos_n">, where n is the element index in this array
	currentPos		: ARRAY[0..1] OF LREAL; 

	(*
	================================================================
	Internal Helper Variables
	Used for the dummy logic to increment values.
	================================================================
	*)
	_counter		: DINT := 0;
	_angle			: LREAL;

END_VAR
]]></Declaration>
    <Implementation>
      <ST><![CDATA[// 1. Increment a simple counter on every PLC cycle.
_counter := _counter + 1;

// 2. Make the error status flag toggle on and off.
IF (_counter MOD 1000) = 0 THEN
	statusError := NOT statusError;
END_IF;

// 3. Simulate a fluctuating battery voltage using a sine wave.
_angle := DINT_TO_LREAL(_counter) * 0.01;
batteryVoltage := 24.0 + (SIN(_angle) * 0.5);

// 4. Simulate changing joint positions.
currentPos[0] := currentPos[0] + 0.0005;
currentPos[1] := COS(_angle * 2.0);]]></ST>
    </Implementation>
    <LineIds Name="MAIN">
      <LineId Id="78" Count="3" />
      <LineId Id="85" Count="0" />
      <LineId Id="131" Count="2" />
      <LineId Id="86" Count="0" />
      <LineId Id="88" Count="3" />
      <LineId Id="93" Count="0" />
      <LineId Id="96" Count="0" />
    </LineIds>
  </POU>
</TcPlcObject>